<span [ngClass]="{'ui-autocomplete ui-widget':true,'ui-autocomplete-dd':dropdown,'ui-autocomplete-multiple':multiple}" [ngStyle]="style" [class]="styleClass">
    <input *ngIf="!multiple" #in [attr.type]="type" [attr.id]="inputId" [ngStyle]="inputStyle" [class]="inputStyleClass" [autocomplete]="autocomplete" [attr.required]="required" [attr.name]="name"
        [ngClass]="'ui-inputtext ui-widget ui-state-default ui-corner-all ui-autocomplete-input'" [value]="inputFieldValue" aria-autocomplete="list" role="combobox" [attr.aria-expanded]="overlayVisible" aria-haspopup="true" [attr.aria-activedescendant]="'p-highlighted-option'"
        (click)="onInputClick($event)" (input)="onInput($event)" (keydown)="onKeydown($event)" (keyup)="onKeyup($event)" [attr.autofocus]="autofocus" (focus)="onInputFocus($event)" (blur)="onInputBlur($event)" (change)="onInputChange($event)" (paste)="onInputPaste($event)"
        [attr.placeholder]="placeholder" [attr.size]="size" [attr.maxlength]="maxlength" [attr.tabindex]="tabindex" [readonly]="readonly" [disabled]="disabled" [attr.aria-label]="ariaLabel" [attr.aria-labelledby]="ariaLabelledBy" [attr.aria-required]="required">

    <ul *ngIf="multiple" #multiContainer class="ui-autocomplete-multiple-container ui-widget ui-inputtext ui-state-default ui-corner-all" [ngClass]="{'ui-state-disabled':disabled,'ui-state-focus':focus}" (click)="multiIn.focus()">
        <li #token *ngFor="let val of value" class="ui-autocomplete-token ui-state-highlight ui-corner-all">
            <span class="ui-autocomplete-token-icon pi pi-fw pi-times" (click)="removeItem(token)" *ngIf="!disabled"></span>
            <span *ngIf="!selectedItemTemplate" class="ui-autocomplete-token-label">{{resolveFieldData(val)}}</span>
            <ng-container *ngTemplateOutlet="selectedItemTemplate; context: {$implicit: val}"></ng-container>
        </li>
        <li class="ui-autocomplete-input-token">
            <input #multiIn [attr.type]="type" [attr.id]="inputId" [disabled]="disabled" [attr.placeholder]="(value&&value.length ? null : placeholder)" [attr.tabindex]="tabindex" (input)="onInput($event)"  (click)="onInputClick($event)"
                (keydown)="onKeydown($event)" [readonly]="readonly" (keyup)="onKeyup($event)" [attr.autofocus]="autofocus" (focus)="onInputFocus($event)" (blur)="onInputBlur($event)" (change)="onInputChange($event)" (paste)="onInputPaste($event)" [autocomplete]="autocomplete"
                [ngStyle]="inputStyle" [class]="inputStyleClass" [attr.aria-label]="ariaLabel" [attr.aria-labelledby]="ariaLabelledBy" [attr.aria-required]="required"
                aria-autocomplete="list" role="combobox" [attr.aria-expanded]="overlayVisible" aria-haspopup="true" [attr.aria-activedescendant]="'p-highlighted-option'">
        </li>
    </ul>

    <i *ngIf="loading" class="ui-autocomplete-loader pi pi-spinner pi-spin"></i>
    <button #ddBtn type="button" pButton [icon]="dropdownIcon" class="ui-autocomplete-dropdown" [disabled]="disabled"
        (click)="handleDropdownClick($event)" *ngIf="dropdown" [attr.tabindex]="tabindex">
    </button>

    <div #panel *ngIf="overlayVisible" [ngClass]="['ui-autocomplete-panel ui-widget ui-widget-content ui-corner-all ui-shadow']"
        [style.max-height]="virtualScroll ? 'auto' : (scrollHeight||'auto')" [ngStyle]="panelStyle" [class]="panelStyleClass"
        [@overlayAnimation]="{value: 'visible', params: {showTransitionParams: showTransitionOptions, hideTransitionParams: hideTransitionOptions}}" (@overlayAnimation.start)="onOverlayAnimationStart($event)" (@overlayAnimation.done)="onOverlayAnimationDone($event)">
        <ul role="listbox" class="ui-autocomplete-items ui-autocomplete-list ui-widget-content ui-widget ui-corner-all ui-helper-reset">
            <ng-container *ngIf="!virtualScroll; else virtualScrollList">
                <p-autoCompleteItem *ngFor="let option of suggestions; let idx = index"
                    [option]="option" [(highlightOption)]="highlightOption" [index]="idx"
                    (onClick)="selectItem($event.option)" [itemSize]="itemSize"
                    [template]="itemTemplate" [resolvedFieldData]="resolveFieldData(option)">
                </p-autoCompleteItem>
            </ng-container>
            <ng-template #virtualScrollList>
                <cdk-virtual-scroll-viewport *ngIf="virtualScroll && suggestions && suggestions.length"
                    [ngStyle]="{height: scrollHeight}" [itemSize]="itemSize">
                    <ng-container *cdkVirtualFor="let option of suggestions; let idx = index">
                        <p-autoCompleteItem
                            [option]="option" [(highlightOption)]="highlightOption" [index]="idx"
                            (onClick)="selectItem($event.option)" [itemSize]="itemSize"
                            [template]="itemTemplate" [resolvedFieldData]="resolveFieldData(option)"
                        ></p-autoCompleteItem>
                    </ng-container>
                </cdk-virtual-scroll-viewport>
            </ng-template>

            <li *ngIf="noResults && emptyMessage" class="ui-autocomplete-emptymessage ui-autocomplete-list-item ui-corner-all">{{emptyMessage}}</li>
        </ul>
    </div>
</span>
